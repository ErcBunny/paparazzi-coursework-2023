<!-- SETTINGS FOR THE SMALL DRONE -->
<!DOCTYPE airframe SYSTEM "../../airframe.dtd">
<airframe>

    <section name="AIRSPEED_SETTINGS">
        <define name="MS45XX_PRESSURE_OFFSET" value="8507.3"/>
        <define name="MS45XX_AIRSPEED_SCALE" value="0.8"/>
        <define name="MS45XX_PRESSURE_RANGE" value="1"/>
    </section>

    <servos>
        <servo name="MOTOR_1" no="0" min="1000" neutral="1050" max="2000"/>
        <servo name="MOTOR_2" no="1" min="1000" neutral="1050" max="2000"/>
        <servo name="MOTOR_3" no="2" min="1000" neutral="1050" max="2000"/>
        <servo name="MOTOR_4" no="3" min="1000" neutral="1050" max="2000"/>

        <servo name="EL_1" no="8" min="670" neutral="1500" max="2330"/>
        <servo name="EL_2" no="9" min="670" neutral="1500" max="2330"/>
        <servo name="EL_3" no="10" min="670" neutral="1500" max="2330"/>
        <servo name="EL_4" no="11" min="670" neutral="1500" max="2330"/>

        <servo name="AZ_1" no="4" min="1050" neutral="1500" max="1950"/>
        <servo name="AZ_2" no="5" min="1050" neutral="1500" max="1950"/>
        <servo name="AZ_3" no="6" min="1050" neutral="1500" max="1950"/>
        <servo name="AZ_4" no="7" min="1050" neutral="1500" max="1950"/>
    </servos>


    <!-- Vehicle properties, see documentation for notation -->
    <section name="VEHICLE_PROPERTIES" prefix="VEHICLE_">
        <define name="I_XX" value="0.06" unit="Kg*m^2"/>
        <define name="I_YY" value="0.1" unit="Kg*m^2"/>
        <define name="I_ZZ" value="0.145" unit="Kg*m^2"/>
        <define name="I_TILT" value="0.000216" unit="Kg*m^2"/>
        <define name="PROPELLER_INERTIA" value="1.984e-5" unit="Kg*m^2"/>
        <define name="MASS" value="2.05" unit="Kg"/>
        <define name="L1" value="0.185" unit="m"/>
        <define name="L2" value="0.185" unit="m"/>
        <define name="L3" value="0.38" unit="m"/>
        <define name="L4" value="0.38" unit="m"/>
        <define name="LZ" value="0." unit="m"/>

        <define name="CL_ALPHA" value="3.5"/>
        <define name="CM_ZERO" value="0.1"/>
        <define name="CM_ALPHA" value="-0.1"/>
        <define name="CD_ZERO" value="0.38"/>
        <define name="K_CD" value="0.2"/>
        <define name="CY_BETA" value="0"/>
        <define name="CL_BETA" value="0"/>
        <define name="S" value="0.25"/>
        <define name="WING_CHORD" value="0.257"/>
        <define name="WING_SPAN" value="1"/>
    </section>

    <section name="OVERACTUATED_VARIABLES" prefix="OVERACTUATED_MIXING_">

    <!-- PID gains wrt the SI units -->
    <define name="PID_P_GAIN_PHI" value="959"/>
    <define name="PID_I_GAIN_PHI" value="5"/>
    <define name="PID_D_GAIN_PHI" value="109"/>

    <define name="PID_P_GAIN_THETA" value="683"/>
    <define name="PID_I_GAIN_THETA" value="20"/>
    <define name="PID_D_GAIN_THETA" value="79"/>

    <define name="PID_P_GAIN_PSI_MOTOR" value="630"/>
    <define name="PID_I_GAIN_PSI_MOTOR" value="50"/>
    <define name="PID_D_GAIN_PSI_MOTOR" value="250"/>

    <define name="PID_P_GAIN_PSI_AZ" value="1.1"/>
    <define name="PID_I_GAIN_PSI_AZ" value="0.5"/>
    <define name="PID_D_GAIN_PSI_AZ" value="0.3"/>

    <define name="PID_P_GAIN_POS_X_TILT" value="1.4"/>
    <define name="PID_I_GAIN_POS_X_TILT" value="0.01"/>
    <define name="PID_D_GAIN_POS_X_TILT" value="0.5"/>

    <define name="PID_P_GAIN_POS_Y_TILT" value="1.4"/>
    <define name="PID_I_GAIN_POS_Y_TILT" value="0.01"/>
    <define name="PID_D_GAIN_POS_Y_TILT" value="0.5"/>

    <!--    Modified the 22/11/2021: the dynamics must be the same since is computed before the body projection!!-->
    <define name="PID_P_GAIN_POS_X_ATT" value="0.3"/>
    <define name="PID_I_GAIN_POS_X_ATT" value="0.1"/>
    <define name="PID_D_GAIN_POS_X_ATT" value="0.28"/>

    <define name="PID_P_GAIN_POS_Y_ATT" value="0.3"/>
    <define name="PID_I_GAIN_POS_Y_ATT" value="0.1"/>
    <define name="PID_D_GAIN_POS_Y_ATT" value="0.28"/>

    <define name="PID_P_GAIN_POS_Z" value="1000"/>
    <define name="PID_I_GAIN_POS_Z" value="50"/>
    <define name="PID_D_GAIN_POS_Z" value="490"/>

    <define name="PID_THR_NEUTRAL_PWM" value="1650"/>

    <!-- Maximum orders -->
    <!-- General -->
    <define name="MAX_PHI" value="30" unit="deg"/>
    <define name="MAX_THETA" value="30" unit="deg"/>
    <define name="MAX_PSI_ERR" value="80" unit="deg"/>

    <!-- PID specific-->
    <define name="PID_MAX_EULER_ERR_INTEGRATIVE" value="40" unit="deg"/>
    <define name="PID_MAX_POS_ERR_INTEGRATIVE" value="3" unit="m"/>
    <define name="PID_MAX_ROLL_ORDER_PWM" value="350"/>
    <define name="PID_MAX_PITCH_ORDER_PWM" value="350"/>
    <define name="PID_MAX_YAW_ORDER_MOTOR_PWM" value="250"/>
    <define name="PID_MAX_YAW_ORDER_AZ" value="25" unit="deg"/> <!--max azimuth deflection in PID mode for YAW command-->
    <define name="PID_MAX_EL_ORDER" value="35" unit="deg"/> <!--max elevator deflection in PID mode-->
    <define name="PID_MAX_AZ_ORDER" value="35" unit="deg"/> <!--max azimuth deflection in PID mode-->

    <!-- INDI proportional gains -->
    <define name="INDI_REF_ERR_P" value="1.2"/>
    <define name="INDI_REF_ERR_Q" value="1.2"/>
    <define name="INDI_REF_ERR_R" value="1.5"/>

    <define name="INDI_REF_ERR_X" value="1.5"/>
    <define name="INDI_REF_ERR_Y" value="1.5"/>
    <define name="INDI_REF_ERR_Z" value="1.3"/>

    <!-- INDI derivative gains -->
    <define name="INDI_REF_RATE_P" value="6"/>
    <define name="INDI_REF_RATE_Q" value="6"/>
    <define name="INDI_REF_RATE_R" value="3.8"/>

    <define name="INDI_REF_RATE_X" value="2"/>
    <define name="INDI_REF_RATE_Y" value="1"/>
    <define name="INDI_REF_RATE_Z" value="4"/>

    <!-- Filters properties for INDI -->
    <define name="FILT_CUTOFF_ANG_RATES" value="25" unit="rad/s"/>
    <define name="FILT_CUTOFF_LIN_ACC" value="25" unit="rad/s"/>
    <define name="FILT_CUTOFF_ACTUATORS_EL" value="25" unit="rad/s"/>
    <define name="FILT_CUTOFF_ACTUATORS_AZ" value="25" unit="rad/s"/>
    <define name="FILT_CUTOFF_ACTUATORS_MOTOR" value="25" unit="rad/s"/>

    <define name="SERVO_EL_1_ZERO_VALUE" value="-56" unit="deg"/>
    <define name="SERVO_EL_2_ZERO_VALUE" value="-54" unit="deg"/>
    <define name="SERVO_EL_3_ZERO_VALUE" value="-52" unit="deg"/>
    <define name="SERVO_EL_4_ZERO_VALUE" value="-52" unit="deg"/>

    <define name="SERVO_AZ_1_ZERO_VALUE" value="0" unit="deg"/>
    <define name="SERVO_AZ_2_ZERO_VALUE" value="0" unit="deg"/>
    <define name="SERVO_AZ_3_ZERO_VALUE" value="0" unit="deg"/>
    <define name="SERVO_AZ_4_ZERO_VALUE" value="0" unit="deg"/>

    <!-- APC PROP-->

    <!--    <define name="MOTOR_K_T_OMEGASQ" value="0.972e-5" unit="N/(rad/s)^2"/>-->
    <!--    <define name="MOTOR_K_M_OMEGASQ" value="1.637e-7" unit="N*m/(rad/s)^2"/>-->
    <!--    <define name="MOTOR_K_PWM_OMEGA" value="1.014" unit="(rad/s)/PWM"/>-->
    <!--    <define name="MOTOR_MAX_OMEGA" value="978" unit="rad/s"/>-->

    <!--    <define name="INDI_MOTOR_FIRST_ORD_NUM_2" value="0.03632" />-->
    <!--    <define name="INDI_MOTOR_FIRST_ORD_DEN_2" value="-0.9637" />-->


    <!-- CF PROP-->

    <define name="MOTOR_K_T_OMEGASQ" value="0.649e-5" unit="N/(rad/s)^2"/>
    <define name="MOTOR_K_M_OMEGASQ" value="0.887e-7" unit="N*m/(rad/s)^2"/>
    <define name="MOTOR_K_PWM_OMEGA" value="1.15" unit="(rad/s)/PWM"/>
    <define name="MOTOR_MAX_OMEGA" value="1104" unit="rad/s"/>

    <define name="INDI_MOTOR_FIRST_ORD_NUM_2" value="0.04877" />
    <define name="INDI_MOTOR_FIRST_ORD_DEN_2" value="-0.9512" />

    <!-- SLOW PROP-->

    <!--    <define name="MOTOR_K_T_OMEGASQ" value="0.882e-5" unit="N/(rad/s)^2"/>-->
    <!--    <define name="MOTOR_K_M_OMEGASQ" value="1.258e-7" unit="N*m/(rad/s)^2"/>-->
    <!--    <define name="MOTOR_K_PWM_OMEGA" value="1.077" unit="(rad/s)/PWM"/>-->
    <!--    <define name="MOTOR_MAX_OMEGA" value="1037" unit="rad/s"/>-->

    <!--    <define name="INDI_MOTOR_FIRST_ORD_NUM_2" value="0.05824" />-->
    <!--    <define name="INDI_MOTOR_FIRST_ORD_DEN_2" value="-0.9418" />-->

    </section>

    <section name="IMU" prefix="IMU_">

    <!-- Calibrated in the MAVLab 30-05-2022 -->
    <define name="ACCEL_X_NEUTRAL" value="-158"/>
    <define name="ACCEL_Y_NEUTRAL" value="46"/>
    <define name="ACCEL_Z_NEUTRAL" value="-47"/>
    <define name="ACCEL_X_SENS" value="4.676300984710756" integer="16"/>
    <define name="ACCEL_Y_SENS" value="4.897253627313201" integer="16"/>
    <define name="ACCEL_Z_SENS" value="4.8042379052498" integer="16"/>

    <!-- Calibrated at TUDelft 30-05-2022 (internal magnetometer) -->
    <define name="MAG_X_NEUTRAL" value="32"/>
    <define name="MAG_Y_NEUTRAL" value="-15"/>
    <define name="MAG_Z_NEUTRAL" value="20"/>
    <define name="MAG_X_SENS" value="12.964015720432243" integer="16"/>
    <define name="MAG_Y_SENS" value="12.568092668400068" integer="16"/>
    <define name="MAG_Z_SENS" value="12.693341287729572" integer="16"/>

    </section>

</airframe>